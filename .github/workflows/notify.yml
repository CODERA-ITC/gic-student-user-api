name: Notify Telegram on Push

on:
  push:
    branches:
      - main
      - dev
jobs:
  notify:
    runs-on: ubuntu-latest

    steps:
      - name: Count new commits in this push
        run: |
          # Counts commits between the previous state (before) and current (after)
          echo "NEW_COMMITS=$(git rev-list --count ${{ github.event.before }}..${{ github.event.after }})" \
            >> $GITHUB_ENV

      - name: Send Telegram message on push
        run: |
          curl -s -X POST "https://api.telegram.org/bot${{ secrets.TELEGRAM_TOKEN }}/sendMessage" \
            -d "chat_id=${{ secrets.TELEGRAM_CHAT_ID }}" \
            -d "reply_to_message_id=97" \
            -d "parse_mode=Markdown" \
            -d "text=ðŸ“Œ *New push on* \`${{ github.ref_name }}\`
          *Repo:* \`${{ github.repository }}\`
          *Actor:* \`${{ github.actor }}\`
          *Author:* \`${{ github.event.head_commit.author.name }}\`
          *Message:* \`${{ github.event.head_commit.message }}\`
          *View:* https://github.com/${{ github.repository }}/commit/${{ github.sha }}
          *New Commits*: $NEW_COMMITS"